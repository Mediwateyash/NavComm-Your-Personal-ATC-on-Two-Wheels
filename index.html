<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NavComm - ATC Bike Navigation</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
  <style>
    /* üåå General Theme */
    body {
      margin: 0;
      background: linear-gradient(180deg, #07121f, #0c1a2b);
      color: #00ffcc;
      font-family: "Orbitron", monospace;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* üß≠ Header Panel */
    #panel {
      text-align: center;
      padding: 20px;
      background: rgba(0, 255, 204, 0.05);
      border-bottom: 1px solid #00ffcc;
      box-shadow: 0 0 10px #00bfa5;
    }

    label {
      margin-right: 10px;
      font-weight: bold;
    }

    input {
      margin: 5px;
      padding: 8px 12px;
      border: 1px solid #00ffcc;
      border-radius: 8px;
      background: #07121f;
      color: #00ffcc;
      outline: none;
      font-family: monospace;
    }

    input:focus {
      box-shadow: 0 0 8px #00ffcc;
    }

    button {
      margin: 10px;
      padding: 8px 15px;
      background: #00ffcc;
      color: #07121f;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      box-shadow: 0 0 10px #00ffcc;
    }

    button:hover {
      background: #00bfa5;
      transform: scale(1.05);
      box-shadow: 0 0 15px #00ffcc;
    }

    /* üó∫Ô∏è Map */
    #map {
      flex: 1;
      border-top: 1px solid #00ffcc;
      border-bottom: 1px solid #00ffcc;
      box-shadow: inset 0 0 10px #00ffcc;
    }

    /* üìü Log Section */
    #log {
      height: 150px;
      overflow-y: auto;
      background: rgba(7, 18, 31, 0.8);
      padding: 10px;
      border-top: 1px solid #00ffcc;
      font-size: 14px;
      font-family: "Courier New", monospace;
    }

    #log p {
      margin: 2px 0;
      color: #7fffd4;
    }

    /* üë£ Footer */
    footer {
      text-align: center;
      background: #05101b;
      padding: 12px;
      border-top: 1px solid #00ffcc;
      font-size: 14px;
      letter-spacing: 0.5px;
    }

    footer a {
      color: #00ffcc;
      text-decoration: none;
      font-weight: bold;
    }

    footer a:hover {
      text-decoration: underline;
      color: #00bfa5;
    }
  </style>
</head>
<body>
  <div id="panel">
    <h2>üõû NAVCOMM - Your Personal ATC on Two Wheels</h2>
    <label>Call Sign:</label>
    <input type="text" id="callsign" placeholder="e.g. EY3934">
    <label>Destination (lat,lon):</label>
    <input type="text" id="dest" placeholder="19.076,72.8777">
    <button onclick="startATC()">üöÄ Start Navigation</button>
    <button onclick="startListening()">üéôÔ∏è Speak</button>
  </div>

  <div id="map"></div>
  <div id="log"></div>

  <footer>
    Designed & Developed by <strong>Diwate Yash</strong> |
    <a href="https://www.linkedin.com/in/yash-diwate" target="_blank">LinkedIn</a> |
    <span>¬© 2025 NavComm Systems</span>
  </footer>

  <script>
    let map, routeControl, userMarker, callSign = "";
    let userLat, userLng, readyForTakeoff = false;
    let lastInstruction = "";

    function logMessage(text) {
      const log = document.getElementById("log");
      log.innerHTML += `<p>${text}</p>`;
      log.scrollTop = log.scrollHeight;
    }

    // Function to convert numbers to aviation-style pronunciation
    function convertNumbersToAviationStyle(text) {
      // Replace numbers with aviation-style pronunciation
      return text.replace(/\d+/g, match => {
        // Convert each digit to aviation pronunciation
        const aviationNumbers = {
          '0': 'zero',
          '1': 'one',
          '2': 'two',
          '3': 'three',
          '4': 'four',
          '5': 'five',
          '6': 'six',
          '7': 'seven',
          '8': 'eight',
          '9': 'niner'
        };
        
        // Convert each digit individually
        return match.split('').map(digit => aviationNumbers[digit] || digit).join(' ');
      });
    }

    function atcSpeak(message, delay = 0) {
      setTimeout(() => {
        // Convert numbers in the message to aviation style
        const aviationMessage = convertNumbersToAviationStyle(message);
        
        const msg = new SpeechSynthesisUtterance(aviationMessage);
        msg.rate = 0.9;
        msg.pitch = 0.8;
        msg.voice = speechSynthesis.getVoices().find(v => v.name.includes("Daniel")) || speechSynthesis.getVoices()[0];
        speechSynthesis.speak(msg);
        logMessage("üéß " + message);
      }, delay);
    }

    function startATC() {
      callSign = document.getElementById("callsign").value.trim().toUpperCase();
      if (!callSign) return alert("Enter your call sign!");
      const dest = document.getElementById("dest").value.split(",");
      if (dest.length !== 2) return alert("Enter destination as lat,lon");
      const destLat = parseFloat(dest[0]), destLng = parseFloat(dest[1]);

      // üéß Cinematic Intro Sequence
      atcSpeak("Hello pilot, welcome to NavComm ‚Äî your personal ATC on two wheels.", 500);
      atcSpeak("System designed and developed by Diwate Yash.", 4000);
      atcSpeak("Initializing route guidance... Standby.", 6500);
      atcSpeak("Navigation systems online.", 9500);
      atcSpeak(`${callSign}, this is Mumbai Tower. You are cleared for takeoff. Are you ready for departure?`, 12500);

      setTimeout(() => {
        map = L.map('map').setView([destLat, destLng], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Map data ¬© OpenStreetMap contributors'
        }).addTo(map);

        navigator.geolocation.watchPosition(pos => {
          userLat = pos.coords.latitude;
          userLng = pos.coords.longitude;

          if (!userMarker) {
            userMarker = L.marker([userLat, userLng]).addTo(map).bindPopup("Your Position");
            map.setView([userLat, userLng], 15);

            // Continue automatically after intro
            setTimeout(() => {
              readyForTakeoff = true;
              atcSpeak(`${callSign}, roger. Proceed straight and maintain speed 60 kilometers per hour.`);
            }, 4000);
          } else {
            userMarker.setLatLng([userLat, userLng]);
          }

          if (!routeControl && readyForTakeoff) {
            routeControl = L.Routing.control({
              waypoints: [L.latLng(userLat, userLng), L.latLng(destLat, destLng)],
              createMarker: () => null,
              addWaypoints: false,
              showAlternatives: true,
              altLineOptions: {
                styles: [
                  { color: 'gray', opacity: 0.5, weight: 5 },
                  { color: 'white', opacity: 0.8, weight: 2 },
                ]
              }
            }).addTo(map);

            routeControl.on('routesfound', function(e) {
              const route = e.routes[0].coordinates;
              checkTurns(route);
            });
          }
        }, err => alert("Location access denied!"), { enableHighAccuracy: true });
      }, 14000);

      startListening();
    }

    function checkTurns(coords) {
      let prevBearing = 0;
      for (let i = 2; i < coords.length; i++) {
        const dx = coords[i].lng - coords[i - 1].lng;
        const dy = coords[i].lat - coords[i - 1].lat;
        const bearing = Math.atan2(dy, dx) * 180 / Math.PI;
        const diff = Math.abs(bearing - prevBearing);
        if (diff > 30 && diff < 150 && lastInstruction !== "turn") {
          const dir = (bearing - prevBearing > 0) ? "left" : "right";
          atcSpeak(`${callSign}, make a ${dir} turn ahead, maintain speed 60 kilometers per hour.`);
          lastInstruction = "turn";
        }
        prevBearing = bearing;
      }
      setTimeout(() => { lastInstruction = ""; }, 15000);
    }

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript.toLowerCase();
      logMessage("üó£Ô∏è You: " + transcript);
      if (transcript.includes("ready for takeoff") || transcript.includes("yes")) {
        readyForTakeoff = true;
        atcSpeak(`Mumbai Tower to ${callSign}, roger. Proceed straight and maintain speed 60 kilometers per hour.`);
      } else if (transcript.includes("roger")) {
        atcSpeak(`Roger ${callSign}, continue current heading.`);
      } else if (transcript.includes("request")) {
        atcSpeak(`Request acknowledged ${callSign}, standby.`);
      } else {
        atcSpeak(`Say again ${callSign}?`);
      }
    };

    function startListening() {
      try {
        recognition.start();
        logMessage("üéôÔ∏è Listening for your response...");
      } catch (e) {
        console.log("Speech recognition not supported or already running.");
      }
    }
  </script>
</body>
</html>